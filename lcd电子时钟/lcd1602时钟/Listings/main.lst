C51 COMPILER V9.60.7.0   MAIN                                                              04/13/2023 21:04:50 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\users\inc) DEBUG OBJECTEXTEND P
                    -RINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <reg52.h>
   2          #include "common.h"
   3          
   4          Environment gEnvironment;
   5          uchar gDispMode = eDisplayMode_dateTime;
   6          uchar gSettingTime = 0;
   7          uchar gSettingDate = 0;
   8          uchar gLcd1602CurSettingRow = 0;
   9          char  gLcd1602CurSettingColPos = -1;
  10          uchar gLcd1602SettingCols[] = {5,6, 8,9, 11,12};
  11          uchar gKey2SettingValue = 0;
  12          
  13          void init();
  14          void run();
  15          void timer0_init();
  16          void key1_action();
  17          void key2_action();
  18          void key3_action();
  19          
  20          void main()
  21          {
  22   1          init();
  23   1          while(1)
  24   1          {
  25   2              while(!TF0);
  26   2              run();
  27   2          }
  28   1      }
  29          
  30          void init()
  31          {
  32   1          gEnvironment.year = 23;
  33   1          gEnvironment.mon = 4;
  34   1          gEnvironment.day = 10;
  35   1          gEnvironment.hour = 22;
  36   1          gEnvironment.min = 40;
  37   1          gEnvironment.sec = 50;
  38   1          gEnvironment.temperature[0] = 25,
  39   1          gEnvironment.temperature[1] = 0,
  40   1          gEnvironment.humidity[0] = 65,
  41   1          gEnvironment.humidity[1] = 0,
  42   1      
  43   1          timer0_init();
  44   1          ds1302_init();
  45   1          lcd1602_init();
  46   1      
  47   1          key_register(0, key1_action);
  48   1          key_register(1, key2_action);
  49   1          key_register(2, key3_action);
  50   1      }
  51          
  52          void run()
  53          {
  54   1          static uint ticketCount = 0;
C51 COMPILER V9.60.7.0   MAIN                                                              04/13/2023 21:04:50 PAGE 2   

  55   1          key_run();
  56   1      
  57   1          if (gLcd1602CurSettingColPos == -1)
  58   1              ds1302_read_time(&gEnvironment); 
  59   1      
  60   1          dht11_read_dat(&gEnvironment);
  61   1          lcd1602_display(gDispMode, &gEnvironment);
  62   1      
  63   1          ticketCount++;
  64   1          if (ticketCount == 100)
  65   1          {
  66   2              ticketCount = 0;
  67   2              //LED_RUN = ~LED_RUN;
  68   2          }
  69   1      }
  70          
  71          void timer0_init()
  72          {
  73   1          TMOD = 0x01;
  74   1          TH0 = (65536 - 5000) / 256;
  75   1          TL0 = (65536 - 5000) % 256;
  76   1          TF0 = 0;
  77   1          TR0 = 1;
  78   1          ET0 = 1;
  79   1          EA = 1;
  80   1      }
  81          
  82          void timer0() interrupt 1
  83          {
  84   1          TH0 = (65536 - 5000) / 256;
  85   1          TL0 = (65536 - 5000) % 256;
  86   1      }
  87          
  88          void key1_action()
  89          {
  90   1          if (gDispMode == eDisplayMode_dateTime) 
  91   1          {
  92   2              gLcd1602CurSettingColPos++;
  93   2              if (gLcd1602CurSettingColPos >= sizeof(gLcd1602SettingCols) / sizeof(uchar))
  94   2              {
  95   3                  gLcd1602CurSettingColPos = 0;
  96   3                  gLcd1602CurSettingRow++;
  97   3      
  98   3                  if (gLcd1602CurSettingRow > 1)
  99   3                      gLcd1602CurSettingRow = 0;
 100   3              }
 101   2      
 102   2              lcd1602_open_gb(gLcd1602CurSettingRow, gLcd1602SettingCols[gLcd1602CurSettingColPos]);
 103   2          }
 104   1      }
 105          
 106          void key2_action()
 107          {
 108   1          if (gLcd1602CurSettingRow == 0) 
 109   1          {
 110   2              switch (gLcd1602CurSettingColPos)
 111   2              {
 112   3                  case 0:
 113   3                  {
 114   4                      gKey2SettingValue++;
 115   4                      if (gKey2SettingValue >= 10)
 116   4                          gKey2SettingValue = 0;
C51 COMPILER V9.60.7.0   MAIN                                                              04/13/2023 21:04:50 PAGE 3   

 117   4                      
 118   4                      lcd1602_display_char(0, 5, gKey2SettingValue);
 119   4                      LED_RUN = ~LED_RUN;
 120   4                      break;
 121   4                  }
 122   3                  case 1:
 123   3                  {  
 124   4                      break;
 125   4                  }
 126   3                  case 2:
 127   3                  {
 128   4                      break;
 129   4                  }
 130   3              }
 131   2          }
 132   1          else if (gLcd1602CurSettingRow == 1)
 133   1          {
 134   2              switch (gLcd1602CurSettingColPos)
 135   2              {
 136   3                  case 0:
 137   3                  {
 138   4                      break;
 139   4                  }
 140   3                  case 1:
 141   3                  {
 142   4                      break;
 143   4                  }
 144   3                  case 2:
 145   3                  {
 146   4                      break;
 147   4                  }
 148   3              }
 149   2          }
 150   1      }
 151          
 152          void key3_action()
 153          {
 154   1          gDispMode++;
 155   1          if (gDispMode >= eDisplayMode_max) 
 156   1              gDispMode = eDisplayMode_dateTime;
 157   1      
 158   1          if (gDispMode == eDisplayMode_tpHumi)
 159   1          {
 160   2              if (gSettingTime)
 161   2              {
 162   3                  ds1302_set_time(eDs1302_Set_hms, &gEnvironment);
 163   3                  gSettingTime = 0;
 164   3              }
 165   2      
 166   2              if (gSettingDate)
 167   2              {
 168   3                  ds1302_set_time(eDs1302_Set_ymd, &gEnvironment);
 169   3                  gSettingDate = 0;
 170   3              }
 171   2          }
 172   1      
 173   1          gLcd1602CurSettingRow = 0;
 174   1          gLcd1602CurSettingColPos = -1;
 175   1          lcd1602_close_gb();
 176   1      }


C51 COMPILER V9.60.7.0   MAIN                                                              04/13/2023 21:04:50 PAGE 4   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    307    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     24    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
